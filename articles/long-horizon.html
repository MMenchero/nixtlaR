<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Long-Horizon Forecasting • nixtlar</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Long-Horizon Forecasting">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">nixtlar</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.6.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/get-started.html">Get Started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">News</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/anomaly-detection.html">Anomaly Detection</a></li>
    <li><a class="dropdown-item" href="../articles/azure-quickstart.html">Azure Quickstart</a></li>
    <li><a class="dropdown-item" href="../articles/cross-validation.html">Cross-Validation</a></li>
    <li><a class="dropdown-item" href="../articles/data-requirements.html">Data requirements</a></li>
    <li><a class="dropdown-item" href="../articles/exogenous-variables.html">Exogenous Variables</a></li>
    <li><a class="dropdown-item" href="../articles/fine-tuning.html">Fine-tuning</a></li>
    <li><a class="dropdown-item" href="../articles/historical-forecast.html">Historical Forecast</a></li>
    <li><a class="dropdown-item" href="../articles/long-horizon.html">Long Horizon Forecast</a></li>
    <li><a class="dropdown-item" href="../articles/prediction-intervals.html">Prediction Intervals</a></li>
    <li><a class="dropdown-item" href="../articles/quantiles.html">Quantile Forecasts</a></li>
    <li><a class="dropdown-item" href="../articles/setting-up-your-api-key.html">Setting Up Your API Key</a></li>
    <li><a class="dropdown-item" href="../articles/special-topics.html">Special Topics</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-experiments" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Experiments</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-experiments">
<li><a class="dropdown-item" href="../articles/vn1-forecasting-competition.html">VN1 Competition</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/Nixtla/nixtlar"><span class="fa fa-github"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://docs.nixtla.io/">Nixtla</a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Long-Horizon Forecasting</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/Nixtla/nixtlar/blob/master/vignettes/long-horizon.Rmd" class="external-link"><code>vignettes/long-horizon.Rmd</code></a></small>
      <div class="d-none name"><code>long-horizon.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://nixtla.github.io/nixtlar/">nixtlar</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Error in get(paste0(generic, ".", class), envir = get_method_env()) : </span></span>
<span><span class="co">#&gt;   object 'type_sum.accel' not found</span></span></code></pre></div>
<div class="section level2">
<h2 id="long-horizon-forecasting">1. Long-horizon forecasting<a class="anchor" aria-label="anchor" href="#long-horizon-forecasting"></a>
</h2>
<p>In some cases, it is necessary to forecast long horizons. Here “long
horizons” refer to predictions that exceed more than two seasonal
periods. For example, this would mean forecasting more than 48 hours
ahead for hourly data or more than 7 days for daily data. The specific
definition of “long horizon” varies depending on the data frequency.</p>
<p>There is a specialized <code>TimeGPT</code> model designed for
long-horizon forecasting, which is trained to predict far into the
future, where the uncertainty increases as the forecast extends further.
Here we will explain how to use the long horizon model of
<code>TimeGPT</code> via <code>nixtlar</code>.</p>
<p>This vignette assumes you have already set up your API key. If you
haven’t done this, please read the <a href="https://nixtla.github.io/nixtlar/articles/get-started.html">Get
Started</a> vignette first.</p>
</div>
<div class="section level2">
<h2 id="load-data">2. Load data<a class="anchor" aria-label="anchor" href="#load-data"></a>
</h2>
<p>For this vignette, we’ll use the electricity consumption dataset that
is included in <code>nixtlar</code>, which contains the hourly prices of
five different electricity markets.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu">nixtlar</span><span class="fu">::</span><span class="va"><a href="../reference/electricity.html">electricity</a></span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span></span>
<span><span class="co">#&gt;   unique_id                  ds     y</span></span>
<span><span class="co">#&gt; 1        BE 2016-10-22 00:00:00 70.00</span></span>
<span><span class="co">#&gt; 2        BE 2016-10-22 01:00:00 37.10</span></span>
<span><span class="co">#&gt; 3        BE 2016-10-22 02:00:00 37.10</span></span>
<span><span class="co">#&gt; 4        BE 2016-10-22 03:00:00 44.75</span></span>
<span><span class="co">#&gt; 5        BE 2016-10-22 04:00:00 37.10</span></span>
<span><span class="co">#&gt; 6        BE 2016-10-22 05:00:00 35.61</span></span></code></pre></div>
<p>For every <code>unique_id</code>, we’ll try to predict the last 96
hours. Hence, we will first separate the data into training and test
sets.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">test</span> <span class="op">&lt;-</span> <span class="va">df</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">unique_id</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice_tail</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">96</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">train</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span><span class="va">df</span><span class="op">$</span><span class="va">ds</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/sets.html" class="external-link">setdiff</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">ds</span>, <span class="va">test</span><span class="op">$</span><span class="va">ds</span><span class="op">)</span>, <span class="op">]</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="forecast-with-a-long-horizon">3. Forecast with a long-horizon<a class="anchor" aria-label="anchor" href="#forecast-with-a-long-horizon"></a>
</h2>
<p>To use the long-horizon model of <code>TimeGPT</code>, set the
<code>model</code> argument to <code>timegpt-1-long-horizon</code>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fcst_long_horizon</span> <span class="op">&lt;-</span> <span class="fu">nixtlar</span><span class="fu">::</span><span class="fu"><a href="../reference/nixtla_client_forecast.html">nixtla_client_forecast</a></span><span class="op">(</span><span class="va">train</span>, h<span class="op">=</span><span class="fl">96</span>, model<span class="op">=</span><span class="st">"timegpt-1-long-horizon"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Frequency chosen: h</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">fcst_long_horizon</span><span class="op">)</span></span>
<span><span class="co">#&gt;   unique_id                  ds  TimeGPT</span></span>
<span><span class="co">#&gt; 1        BE 2016-12-27 00:00:00 42.73280</span></span>
<span><span class="co">#&gt; 2        BE 2016-12-27 01:00:00 38.03184</span></span>
<span><span class="co">#&gt; 3        BE 2016-12-27 02:00:00 35.11706</span></span>
<span><span class="co">#&gt; 4        BE 2016-12-27 03:00:00 34.53464</span></span>
<span><span class="co">#&gt; 5        BE 2016-12-27 04:00:00 34.11326</span></span>
<span><span class="co">#&gt; 6        BE 2016-12-27 05:00:00 38.36180</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="plot-the-long-horizon-forecast">4. Plot the long-horizon forecast<a class="anchor" aria-label="anchor" href="#plot-the-long-horizon-forecast"></a>
</h2>
<p><code>nixtlar</code> includes a function to plot the historical data
and any output from <code><a href="../reference/nixtla_client_forecast.html">nixtlar::nixtla_client_forecast</a></code>,
<code><a href="../reference/nixtla_client_historic.html">nixtlar::nixtla_client_historic</a></code>,
<code><a href="../reference/nixtla_client_detect_anomalies.html">nixtlar::nixtla_client_detect_anomalies</a></code> and
<code><a href="../reference/nixtla_client_cross_validation.html">nixtlar::nixtla_client_cross_validation</a></code>. If you have long
series, you can use <code>max_insample_length</code> to only plot the
last N historical values (the forecast will always be plotted in
full).</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">nixtlar</span><span class="fu">::</span><span class="fu"><a href="../reference/nixtla_client_plot.html">nixtla_client_plot</a></span><span class="op">(</span><span class="va">train</span>, <span class="va">fcst_long_horizon</span>, max_insample_length <span class="op">=</span> <span class="fl">200</span><span class="op">)</span></span></code></pre></div>
<p><img src="long-horizon_files/figure-html/unnamed-chunk-5-1.png" width="672"></p>
</div>
<div class="section level2">
<h2 id="evaluate-the-long-horizon-model">5. Evaluate the long-horizon model<a class="anchor" aria-label="anchor" href="#evaluate-the-long-horizon-model"></a>
</h2>
<p>To evaluate the long-horizon forecast, we will generate the same
forecast with the default model of <code>TimeGPT</code>, which is
<code>timegpt-1</code>, and then we will compute and compare the <a href="https://en.wikipedia.org/wiki/Mean_absolute_error" class="external-link">Mean Absolute
Error</a> (MAE) of the two models.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fcst</span> <span class="op">&lt;-</span> <span class="fu">nixtlar</span><span class="fu">::</span><span class="fu"><a href="../reference/nixtla_client_forecast.html">nixtla_client_forecast</a></span><span class="op">(</span><span class="va">train</span>, h<span class="op">=</span><span class="fl">96</span><span class="op">)</span></span>
<span><span class="co">#&gt; Frequency chosen: h</span></span>
<span><span class="co">#&gt; The specified horizon h exceeds the model horizon. This may lead to less accurate forecasts. Please consider using a smaller horizon.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">fcst</span><span class="op">)</span></span>
<span><span class="co">#&gt;   unique_id                  ds  TimeGPT</span></span>
<span><span class="co">#&gt; 1        BE 2016-12-27 00:00:00 45.21978</span></span>
<span><span class="co">#&gt; 2        BE 2016-12-27 01:00:00 42.56768</span></span>
<span><span class="co">#&gt; 3        BE 2016-12-27 02:00:00 41.56037</span></span>
<span><span class="co">#&gt; 4        BE 2016-12-27 03:00:00 39.12515</span></span>
<span><span class="co">#&gt; 5        BE 2016-12-27 04:00:00 36.47123</span></span>
<span><span class="co">#&gt; 6        BE 2016-12-27 05:00:00 37.22324</span></span></code></pre></div>
<p>We will rename the <code>TimeGPT</code> long-horizon model to merge
it with the default <code>TimeGPT</code> model. After that, we will
combine them with the actual values from the test set and compute the
MAE. Note that in the output of the <code>nixtla_client_forecast</code>
function, the <code>ds</code> column contains dates. This is because
<code>nixtla_client_plot</code> uses the dates for plotting. However, to
merge the actual values, we will convert the dates to characters.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">fcst_long_horizon</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">fcst_long_horizon</span><span class="op">)</span> <span class="op">==</span> <span class="st">"TimeGPT"</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"TimeGPT-long-horizon"</span></span>
<span></span>
<span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="va">fcst</span>, <span class="va">fcst_long_horizon</span><span class="op">)</span> <span class="co"># merge TimeGPT and TimeGPT-long-horizon</span></span>
<span><span class="va">res</span><span class="op">$</span><span class="va">ds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">res</span><span class="op">$</span><span class="va">ds</span><span class="op">)</span></span>
<span></span>
<span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="va">test</span>, <span class="va">res</span><span class="op">)</span> <span class="co"># merge with actual values</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span></span>
<span><span class="co">#&gt;   unique_id                  ds     y  TimeGPT TimeGPT-long-horizon</span></span>
<span><span class="co">#&gt; 1        BE 2016-12-27 01:00:00 38.33 42.56768             38.03184</span></span>
<span><span class="co">#&gt; 2        BE 2016-12-27 02:00:00 41.04 41.56037             35.11706</span></span>
<span><span class="co">#&gt; 3        BE 2016-12-27 03:00:00 34.62 39.12515             34.53464</span></span>
<span><span class="co">#&gt; 4        BE 2016-12-27 04:00:00 29.69 36.47123             34.11326</span></span>
<span><span class="co">#&gt; 5        BE 2016-12-27 05:00:00 28.35 37.22324             38.36180</span></span>
<span><span class="co">#&gt; 6        BE 2016-12-27 06:00:00 30.99 42.28075             47.14175</span></span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"MAE TimeGPT: "</span>, <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">res</span><span class="op">$</span><span class="va">y</span><span class="op">-</span><span class="va">res</span><span class="op">$</span><span class="va">TimeGPT</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "MAE TimeGPT: 8.89937971816304"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"MAE TimeGPT long-horizon: "</span>, <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">res</span><span class="op">$</span><span class="va">y</span><span class="op">-</span><span class="va">res</span><span class="op">$</span><span class="va">`TimeGPT-long-horizon`</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "MAE TimeGPT long-horizon: 7.09790721521739"</span></span></code></pre></div>
<p>As we can see, the long-horizon version of <code>TimeGPT</code>
produced a model with a lower MAE than the default <code>TimeGPT</code>
model.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Mariana Menchero.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
