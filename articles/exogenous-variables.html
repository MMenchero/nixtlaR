<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Exogenous Variables • nixtlar</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Exogenous Variables">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">nixtlar</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.6.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/get-started.html">Get Started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">News</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/anomaly-detection.html">Anomaly Detection</a></li>
    <li><a class="dropdown-item" href="../articles/azure-quickstart.html">Azure Quickstart</a></li>
    <li><a class="dropdown-item" href="../articles/cross-validation.html">Cross-Validation</a></li>
    <li><a class="dropdown-item" href="../articles/data-requirements.html">Data requirements</a></li>
    <li><a class="dropdown-item" href="../articles/exogenous-variables.html">Exogenous Variables</a></li>
    <li><a class="dropdown-item" href="../articles/fine-tuning.html">Fine-tuning</a></li>
    <li><a class="dropdown-item" href="../articles/historical-forecast.html">Historical Forecast</a></li>
    <li><a class="dropdown-item" href="../articles/long-horizon.html">Long Horizon Forecast</a></li>
    <li><a class="dropdown-item" href="../articles/prediction-intervals.html">Prediction Intervals</a></li>
    <li><a class="dropdown-item" href="../articles/quantiles.html">Quantile Forecasts</a></li>
    <li><a class="dropdown-item" href="../articles/setting-up-your-api-key.html">Setting Up Your API Key</a></li>
    <li><a class="dropdown-item" href="../articles/special-topics.html">Special Topics</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-experiments" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Experiments</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-experiments">
<li><a class="dropdown-item" href="../articles/vn1-forecasting-competition.html">VN1 Competition</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/Nixtla/nixtlar"><span class="fa fa-github"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://docs.nixtla.io/">Nixtla</a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Exogenous Variables</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/Nixtla/nixtlar/blob/v0.6.4/vignettes/exogenous-variables.Rmd" class="external-link"><code>vignettes/exogenous-variables.Rmd</code></a></small>
      <div class="d-none name"><code>exogenous-variables.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://nixtla.github.io/nixtlar/">nixtlar</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="exogenous-variables">1. Exogenous variables<a class="anchor" aria-label="anchor" href="#exogenous-variables"></a>
</h2>
<p>Exogenous variables are external factors that provide additional
information about the behavior of the target variable in time series
forecasting. These variables, which are correlated with the target, can
significantly improve predictions. Examples of exogenous variables
include weather data, economic indicators, holiday markers, and
promotional sales.</p>
<p><code>TimeGPT</code> allows you to include exogenous variables when
generating a forecast. This vignette will show you how to include them.
It assumes you have already set up your API key. If you haven’t done
this, please read the <a href="https://nixtla.github.io/nixtlar/articles/get-started.html">Get
Started</a> vignette first.</p>
</div>
<div class="section level2">
<h2 id="load-data">2. Load data<a class="anchor" aria-label="anchor" href="#load-data"></a>
</h2>
<p>For this vignette, we will use the electricity consumption dataset
with exogenous variables included in <code>nixtlar</code>. This dataset
contains hourly prices from five different electricity markets, along
with two exogenous variables related to the prices and binary variables
indicating the day of the week.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_exo_vars</span> <span class="op">&lt;-</span> <span class="fu">nixtlar</span><span class="fu">::</span><span class="va"><a href="../reference/electricity_exo_vars.html">electricity_exo_vars</a></span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">df_exo_vars</span><span class="op">)</span></span>
<span><span class="co">#&gt;   unique_id                  ds     y Exogenous1 Exogenous2 day_0 day_1 day_2</span></span>
<span><span class="co">#&gt; 1        BE 2016-10-22 00:00:00 70.00      49593      57253     0     0     0</span></span>
<span><span class="co">#&gt; 2        BE 2016-10-22 01:00:00 37.10      46073      51887     0     0     0</span></span>
<span><span class="co">#&gt; 3        BE 2016-10-22 02:00:00 37.10      44927      51896     0     0     0</span></span>
<span><span class="co">#&gt; 4        BE 2016-10-22 03:00:00 44.75      44483      48428     0     0     0</span></span>
<span><span class="co">#&gt; 5        BE 2016-10-22 04:00:00 37.10      44338      46721     0     0     0</span></span>
<span><span class="co">#&gt; 6        BE 2016-10-22 05:00:00 35.61      44504      46303     0     0     0</span></span>
<span><span class="co">#&gt;   day_3 day_4 day_5 day_6</span></span>
<span><span class="co">#&gt; 1     0     0     1     0</span></span>
<span><span class="co">#&gt; 2     0     0     1     0</span></span>
<span><span class="co">#&gt; 3     0     0     1     0</span></span>
<span><span class="co">#&gt; 4     0     0     1     0</span></span>
<span><span class="co">#&gt; 5     0     0     1     0</span></span>
<span><span class="co">#&gt; 6     0     0     1     0</span></span></code></pre></div>
<p>There are two types of exogenous variables: <strong>historic</strong>
and <strong>future</strong>.</p>
<ul>
<li>
<strong>Historic Exogenous Variables</strong>: They should be
included directly in the input dataset <code>df</code>.<br>
</li>
<li>
<strong>Future Exogenous Variables</strong>: They must be included
in the <code>X_df</code> parameter.</li>
</ul>
<p>To specify which variables should be treated as historic, use the
<code>hist_exog_list</code> parameter. This parameter is available in
both the <code>forecast</code> and <code>cross_validation</code>
functions.</p>
<ul>
<li>If <code>df</code> contains exogenous variables but they are not
found in <code>X_df</code> nor declared in <code>hist_exog_list</code>,
they will be ignored.<br>
</li>
<li>If exogenous variables were declared as historic but found in
<code>X_df</code>, then they will be considered as historic.</li>
</ul>
<p>In the next section, we will explore different cases for forecasting
with exogenous variables.</p>
</div>
<div class="section level2">
<h2 id="a--forecasting-electricity-prices-using-historic-and-future-exogenous-variables">3a. Forecasting electricity prices using historic and future
exogenous variables<a class="anchor" aria-label="anchor" href="#a--forecasting-electricity-prices-using-historic-and-future-exogenous-variables"></a>
</h2>
<p>If both historic and future values of all exogenous variables are
available, include the historic exogenous variables in <code>df</code>
and the future exogenous variables in <code>X_df</code>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">future_exo_vars</span> <span class="op">&lt;-</span> <span class="fu">nixtlar</span><span class="fu">::</span><span class="va"><a href="../reference/electricity_future_exo_vars.html">electricity_future_exo_vars</a></span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">future_exo_vars</span><span class="op">)</span></span>
<span><span class="co">#&gt;   unique_id                  ds Exogenous1 Exogenous2 day_0 day_1 day_2 day_3</span></span>
<span><span class="co">#&gt; 1        BE 2016-12-31 00:00:00      64108      70318     0     0     0     0</span></span>
<span><span class="co">#&gt; 2        BE 2016-12-31 01:00:00      62492      67898     0     0     0     0</span></span>
<span><span class="co">#&gt; 3        BE 2016-12-31 02:00:00      61571      68379     0     0     0     0</span></span>
<span><span class="co">#&gt; 4        BE 2016-12-31 03:00:00      60381      64972     0     0     0     0</span></span>
<span><span class="co">#&gt; 5        BE 2016-12-31 04:00:00      60298      62900     0     0     0     0</span></span>
<span><span class="co">#&gt; 6        BE 2016-12-31 05:00:00      60339      62364     0     0     0     0</span></span>
<span><span class="co">#&gt;   day_4 day_5 day_6</span></span>
<span><span class="co">#&gt; 1     0     1     0</span></span>
<span><span class="co">#&gt; 2     0     1     0</span></span>
<span><span class="co">#&gt; 3     0     1     0</span></span>
<span><span class="co">#&gt; 4     0     1     0</span></span>
<span><span class="co">#&gt; 5     0     1     0</span></span>
<span><span class="co">#&gt; 6     0     1     0</span></span>
<span></span>
<span><span class="va">fcst_exo_vars</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nixtla_client_forecast.html">nixtla_client_forecast</a></span><span class="op">(</span><span class="va">df_exo_vars</span>, h <span class="op">=</span> <span class="fl">24</span>, X_df <span class="op">=</span> <span class="va">future_exo_vars</span><span class="op">)</span></span>
<span><span class="co">#&gt; Frequency chosen: h</span></span>
<span><span class="co">#&gt; Using future exogenous features: [Exogenous1, Exogenous2, day_0, day_1, day_2, day_3, day_4, day_5, day_6]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">fcst_exo_vars</span><span class="op">)</span></span>
<span><span class="co">#&gt;   unique_id                  ds  TimeGPT</span></span>
<span><span class="co">#&gt; 1        BE 2016-12-31 00:00:00 74.54068</span></span>
<span><span class="co">#&gt; 2        BE 2016-12-31 01:00:00 43.34399</span></span>
<span><span class="co">#&gt; 3        BE 2016-12-31 02:00:00 44.42881</span></span>
<span><span class="co">#&gt; 4        BE 2016-12-31 03:00:00 38.09382</span></span>
<span><span class="co">#&gt; 5        BE 2016-12-31 04:00:00 37.38807</span></span>
<span><span class="co">#&gt; 6        BE 2016-12-31 05:00:00 39.08492</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="b--forecasting-electricity-prices-using-only-historic-exogenous-variables">3b. Forecasting electricity prices using only historic exogenous
variables<a class="anchor" aria-label="anchor" href="#b--forecasting-electricity-prices-using-only-historic-exogenous-variables"></a>
</h2>
<p>If future values of the exogenous variables are not available, you
can still generate forecasts using only their historical values. In this
case, simply include them in <code>df</code>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fcst_exo_vars</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nixtla_client_forecast.html">nixtla_client_forecast</a></span><span class="op">(</span><span class="va">df_exo_vars</span>, h <span class="op">=</span> <span class="fl">24</span><span class="op">)</span></span>
<span><span class="co">#&gt; Frequency chosen: h</span></span>
<span><span class="co">#&gt; Input contains the following exogenous features: [Exogenous1, Exogenous2, day_0, day_1, day_2, day_3, day_4, day_5, day_6] but X_df was not provided and they were not declared in hist_exog_list. They will be ignored.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">fcst_exo_vars</span><span class="op">)</span></span>
<span><span class="co">#&gt;   unique_id                  ds  TimeGPT</span></span>
<span><span class="co">#&gt; 1        BE 2016-12-31 00:00:00 45.19122</span></span>
<span><span class="co">#&gt; 2        BE 2016-12-31 01:00:00 43.24537</span></span>
<span><span class="co">#&gt; 3        BE 2016-12-31 02:00:00 41.95892</span></span>
<span><span class="co">#&gt; 4        BE 2016-12-31 03:00:00 39.79675</span></span>
<span><span class="co">#&gt; 5        BE 2016-12-31 04:00:00 39.20512</span></span>
<span><span class="co">#&gt; 6        BE 2016-12-31 05:00:00 40.10902</span></span></code></pre></div>
<p><strong>Important:</strong> If you include historical exogenous
variables without explicitly defining their future values, you are
implicitly assuming that their historical patterns will continue into
the future. Whenever possible, it is recommended to use future exogenous
variables to make these assumptions explicit.</p>
</div>
<div class="section level2">
<h2 id="c--forecasting-future-exogenous-variables">3c. Forecasting future exogenous variables<a class="anchor" aria-label="anchor" href="#c--forecasting-future-exogenous-variables"></a>
</h2>
<p>When future exogenous variables are not available, an alternative
approach is to forecast them separately using TimeGPT. First, generate
forecasts for the exogenous variables and then pass the predicted values
in <code>X_df</code> for the main forecast.</p>
</div>
<div class="section level2">
<h2 id="d--forecasting-electricity-prices-using-both-future-and-historic-exogenous-variables">3d. Forecasting electricity prices using both future and historic
exogenous variables<a class="anchor" aria-label="anchor" href="#d--forecasting-electricity-prices-using-both-future-and-historic-exogenous-variables"></a>
</h2>
<p>In some cases, only a subset of future exogenous variables is
available. For example, if future values of <code>Exogenous1</code> and
<code>Exogenous2</code> are unknown, add them to
<code>hist_exog_list</code>.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">future_exo_vars</span> <span class="op">&lt;-</span> <span class="va">future_exo_vars</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html" class="external-link">all_of</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Exogenous1"</span>, <span class="st">"Exogenous2"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">fcst_exo_vars</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nixtla_client_forecast.html">nixtla_client_forecast</a></span><span class="op">(</span><span class="va">df_exo_vars</span>, h <span class="op">=</span> <span class="fl">24</span>, hist_exog_list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Exogenous1"</span>, <span class="st">"Exogenous2"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Frequency chosen: h</span></span>
<span><span class="co">#&gt; Input contains the following exogenous features: [day_0, day_1, day_2, day_3, day_4, day_5, day_6] but X_df was not provided and they were not declared in hist_exog_list. They will be ignored.</span></span>
<span><span class="co">#&gt; Using historical exogenous features: [Exogenous1, Exogenous2]</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="plot-timegpt-forecast">4. Plot TimeGPT forecast<a class="anchor" aria-label="anchor" href="#plot-timegpt-forecast"></a>
</h2>
<p><code>nixtlar</code> includes a function to plot the historical data
and any output from <code>nixtla_client_forecast</code>,
<code>nixtla_client_historic</code>,
<code>nixtla_client_anomaly_detection</code> and
<code>nixtla_client_cross_validation</code>. If you have long series,
you can use <code>max_insample_length</code> to only plot the last N
historical values (the forecast will always be plotted in full).</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/nixtla_client_plot.html">nixtla_client_plot</a></span><span class="op">(</span><span class="va">df_exo_vars</span>, <span class="va">fcst_exo_vars</span>, max_insample_length <span class="op">=</span> <span class="fl">500</span><span class="op">)</span></span></code></pre></div>
<p><img src="exogenous-variables_files/figure-html/unnamed-chunk-6-1.png" width="672"></p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Mariana Menchero.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
